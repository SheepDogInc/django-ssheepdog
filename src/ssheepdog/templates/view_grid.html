{% extends 'base.html' %}
{% block content %}

<div class="head grid">
  <form class="logout" action="{% url logout %}" method="get">
    <input class="button" type="submit" value="logout"/>
  </form>
  <form action="{% url ssheepdog.views.view_access_summary %}" method="get">
   <ul>
      {{ filter_form }}
      <input class="button" type="submit" value="filter"/>
    </ul>
  </form>
</div>

{% if logins and users %}
<table class="access_view">
    <thead>
        <tr class="top_header">
            <th></th>
            <th>Client</th>
            <th>Machine</th>
            <th>Login</th>
            {% for user in users %}
            <th><a class="user" href="{% url ssheepdog.views.user_admin_view user.pk %}">{{ user.get_profile.nickname }}</a></th>
            {% endfor %}
        </tr>
    </thead>

    <tbody>
    
        {% for login in logins %}

            <tr class="{% cycle 'row1' 'row2' %}">
                <td>
                    {% if login.is_dirty %}
                        {% if perms.ssheepdog.can_sync %}
                        <form class="sync_form" action="{% url ssheepdog.views.sync_keys %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="pk" value="{{ login.pk }}">
                            <input class="sync dirty" type="submit" value="sync" id="sync_form"/>
                        </form>
                        {% else %}
                        <input class="sync dirty" type="submit" value="        "> 
                        {% endif %}
                    {% else %}
                    <input class="sync clean" type="submit" value="        "> 
                    {% endif %}
                </td>
                <th title="{{ login.client.description }}">{{ login.client.nickname }}</th>
                <th title="{{ login.machine.description }}">{{ login.machine.nickname }}</th>
                <th title="{{ login.description }}"> <a class="login" href="{% url ssheepdog.views.login_admin_view login.pk %}"> {{login.username}} </a></th>

                {% for entry in login.entries %}
                    {% comment %}
                        Add two classes: is_allowed or not_allowed AND active or inactive
                        For example:  class="allowed active"
                    {% endcomment %}
                    <td class="entry {% if entry.is_allowed %}is_allowed{% endif %} {% if entry.is_active %}active{% endif %}">
                        &nbsp;
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}

    </tbody>

</table>

{% if perms.ssheepdog.can_sync %}
<form class="sync_form" action="{% url ssheepdog.views.sync_keys %}" method="post">
    {% csrf_token %}
    <input class="sync_all" type="submit" value="sync all" id="sync_form"/>
</form>

<form class="sync_form" action="{% url ssheepdog.views.generate_new_application_key %}" method="post">
    {% csrf_token %}
    <input class="new_app_key" type="submit" value="new app key" id="new_app_key"/>
</form>
{% endif %}

{% else %}
  <p>No {% if logins %}users{% else %}logins{% endif %}</p>
{% endif %}
{% endblock %}
